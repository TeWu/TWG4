<% self.title = "#{@photo.id} - #{@album.name}" %>
<% content_for :context_menu do %>
  <%= destroy_button [@album, @photo] %>
<% end %>

<div id="photo" data-scroll-snap></div>
<section id="photo-image-container">
  <%= photo_image @photo, :medium %>
</section>

<section id="photo-info-and-ctrl">
  <div id="photo-description" class="photo-description"><%= @photo.description %></div>
  <textarea id="photo-description-textarea" style="display: none;" class="photo-description" data-autogrow></textarea>
  <div id="photo-desc-buttons">
    <div id="photo-desc-spinner" style="display: none;"><%= render 'spinner' %></div>
    <div id="photo-desc-editor-controls">
      <%= glyphicon 'ok', id: 'save-desc-btn', hidden: true %>
      <%= glyphicon 'remove', id: 'cancel-desc-edit-btn', hidden: true %>
    </div>
    <div id="photo-desc-controls">
      <%= glyphicon 'pencil', id: 'edit-desc-btn' if soft_can? :update, [@album, @photo] %>
      <%= glyphicon 'comment', id: 'comment-indicator' if @comments.any? %>
    </div>
  </div>
  <div id="photo-controls">
    <div class="btn-group" role="group">
      <a role="button" href="<%= prev_photo_path(@album, @photo) %>" class="btn btn-default"><%= glyphicon 'arrow-left' %></a>
      <a role="button" href="<%= next_photo_path(@album, @photo) %>" class="btn btn-default">Next<%= glyphicon 'arrow-right', style: "margin-left: 10px" %></a>
    </div>
  </div>
</section>

<hr/>
<h2>Comments:</h2>
<% if can? :show, @photo => Comment %>
  <ul>
    <% for comment in @comments %>
      <li>
        <strong><%= comment.author.try(:display_name) || "- USER DELETED -" %>:</strong> <%= comment.content %><br/>
        <%= edit_link [@album, @photo, comment] %> <%= destroy_button [@album, @photo, comment], data: {confirm: nil} %>
      </li>
    <% end %>
  </ul>
<% end %>

<% if can? :new, @photo => Comment %>
  <h2>Add comment</h2>
  <%= render 'comments/form', comment: @new_comment %>
<% end %>
